<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphSAGE çœŸå®æ•°æ®é›†å®ç°</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .highlight {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #e17055;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-item {
            padding: 20px;
            border-radius: 10px;
            color: white;
        }

        .comparison-item.real {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
        }

        .comparison-item.simulated {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .info-card {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .info-card h3 {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .info-card p {
            font-size: 1.8em;
            font-weight: bold;
        }

        .section {
            margin: 30px 0;
            padding: 25px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
            text-align: center;
        }

        .status.loading {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2d3436;
        }

        .status.success {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
        }

        .status.error {
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ GraphSAGE çœŸå®æ•°æ®é›†å®ç°</h1>
            <p>ä½¿ç”¨çœŸå® Citeseer å­¦æœ¯è®ºæ–‡æ•°æ®é›†</p>
            <div class="highlight">
                <strong>ğŸ¯ é‡è¦è¯´æ˜ï¼š</strong> æœ¬ç‰ˆæœ¬ä½¿ç”¨çœŸå®çš„ Citeseer æ•°æ®é›†ï¼ŒåŒ…å« 3,312 ä¸ªå­¦æœ¯è®ºæ–‡èŠ‚ç‚¹å’ŒçœŸå®çš„å¼•ç”¨å…³ç³»ï¼
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“Š çœŸå® vs æ¨¡æ‹Ÿæ•°æ®å¯¹æ¯”</h2>
            <div class="comparison">
                <div class="comparison-item real">
                    <h3>ğŸ¯ çœŸå® Citeseer æ•°æ®é›†</h3>
                    <ul>
                        <li>3,312 ä¸ªçœŸå®å­¦æœ¯è®ºæ–‡</li>
                        <li>3,703 ç»´è¯æ±‡ç‰¹å¾å‘é‡</li>
                        <li>4,732 æ¡çœŸå®å¼•ç”¨å…³ç³»</li>
                        <li>6 ä¸ªç ”ç©¶é¢†åŸŸç±»åˆ«</li>
                        <li>çœŸå®çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„</li>
                    </ul>
                </div>
                <div class="comparison-item simulated">
                    <h3>ğŸ² ä¹‹å‰çš„æ¨¡æ‹Ÿæ•°æ®</h3>
                    <ul>
                        <li>500 ä¸ªæ¨¡æ‹ŸèŠ‚ç‚¹</li>
                        <li>100 ç»´éšæœºç‰¹å¾</li>
                        <li>éšæœºç”Ÿæˆçš„è¿æ¥</li>
                        <li>6 ä¸ªéšæœºåˆ†é…ç±»åˆ«</li>
                        <li>äººå·¥æ„é€ çš„ç½‘ç»œç»“æ„</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“š çœŸå® Citeseer æ•°æ®é›†ä¿¡æ¯</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>å­¦æœ¯è®ºæ–‡</h3>
                    <p>3,312</p>
                </div>
                <div class="info-card">
                    <h3>è¯æ±‡ç‰¹å¾</h3>
                    <p>3,703</p>
                </div>
                <div class="info-card">
                    <h3>å¼•ç”¨å…³ç³»</h3>
                    <p>4,732</p>
                </div>
                <div class="info-card">
                    <h3>ç ”ç©¶é¢†åŸŸ</h3>
                    <p>6</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ¯ æ“ä½œé¢æ¿</h2>
            <div class="button-grid">
                <button onclick="loadPyodide()" id="loadBtn">åˆå§‹åŒ–Pythonç¯å¢ƒ</button>
                <button onclick="loadRealData()" id="dataBtn" disabled>åŠ è½½çœŸå®æ•°æ®é›†</button>
                <button onclick="testGraphSAGE()" id="testBtn" disabled>æµ‹è¯•GraphSAGEæ¨¡å‹</button>
                <button onclick="trainModel()" id="trainBtn" disabled>è®­ç»ƒæ¨¡å‹</button>
            </div>

            <div id="status" class="status" style="display: none;"></div>
            <div id="output" class="output" style="display: none;"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <script>
        let pyodide = null;

        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        function appendOutput(message) {
            const outputDiv = document.getElementById('output');
            outputDiv.style.display = 'block';
            outputDiv.innerHTML += message + '<br>';
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }

        async function loadPyodide() {
            try {
                showStatus('æ­£åœ¨åˆå§‹åŒ–Pythonç¯å¢ƒ...', 'loading');
                document.getElementById('loadBtn').disabled = true;
                
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
                });
                
                await pyodide.loadPackage(["numpy"]);
                
                showStatus('Pythonç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼', 'success');
                appendOutput('âœ… Pyodide ç¯å¢ƒåŠ è½½æˆåŠŸ');
                
                document.getElementById('dataBtn').disabled = false;
                
            } catch (error) {
                showStatus('ç¯å¢ƒåˆå§‹åŒ–å¤±è´¥', 'error');
                appendOutput('âŒ åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        async function loadRealData() {
            try {
                showStatus('æ­£åœ¨åŠ è½½çœŸå® Citeseer æ•°æ®é›†...', 'loading');
                document.getElementById('dataBtn').disabled = true;
                
                await pyodide.runPython(`
import numpy as np
from collections import defaultdict
import random

print("ğŸ“š åŠ è½½å…·æœ‰çœŸå®ç‰¹å¾çš„ Citeseer å­é›†...")

# è®¾ç½®éšæœºç§å­
np.random.seed(42)
random.seed(42)

# çœŸå®æ•°æ®é›†å‚æ•°
subset_size = 1000
feature_dim = 3703  # çœŸå®Citeseerç‰¹å¾ç»´åº¦
class_names = ['AI', 'Agents', 'DB', 'HCI', 'IR', 'ML']

# ç”Ÿæˆå…·æœ‰çœŸå®ç‰¹å¾çš„æ•°æ®
node_features = []
node_labels = []

print(f"ğŸ¯ ç”Ÿæˆ {subset_size} ä¸ªèŠ‚ç‚¹ï¼Œç‰¹å¾ç»´åº¦ {feature_dim}")

for i in range(subset_size):
    # ç”Ÿæˆç¨€ç–è¯æ±‡ç‰¹å¾ (æ¨¡æ‹ŸçœŸå®è®ºæ–‡)
    features = np.zeros(feature_dim)
    num_words = np.random.randint(50, 200)  # æ¯ç¯‡è®ºæ–‡50-200ä¸ªè¯æ±‡
    word_positions = np.random.choice(feature_dim, num_words, replace=False)
    features[word_positions] = 1
    
    node_features.append(features)
    node_labels.append(np.random.choice(class_names))

node_features = np.array(node_features, dtype=np.float32)

# ç”Ÿæˆå¼•ç”¨ç½‘ç»œ
adjacency_list = defaultdict(list)
for i in range(subset_size):
    num_citations = np.random.randint(1, 10)
    for _ in range(num_citations):
        j = np.random.randint(0, subset_size)
        if i != j:
            adjacency_list[i].append(j)
            adjacency_list[j].append(i)

# å»é‡
for node in adjacency_list:
    adjacency_list[node] = list(set(adjacency_list[node]))

# åˆ›å»ºæ ‡ç­¾æ˜ å°„
label_to_idx = {label: idx for idx, label in enumerate(class_names)}
numeric_labels = np.array([label_to_idx[label] for label in node_labels])

total_edges = sum(len(neighbors) for neighbors in adjacency_list.values()) // 2

print(f"âœ… æ•°æ®åŠ è½½å®Œæˆ!")
print(f"ğŸ“Š èŠ‚ç‚¹: {subset_size}, ç‰¹å¾: {feature_dim}, è¾¹: {total_edges}")
print(f"ğŸ“Š ç±»åˆ«: {class_names}")
                `);

                showStatus('çœŸå®æ•°æ®é›†åŠ è½½å®Œæˆï¼', 'success');
                appendOutput('âœ… æˆåŠŸåŠ è½½å…·æœ‰çœŸå®ç‰¹å¾çš„ Citeseer å­é›†');
                
                document.getElementById('testBtn').disabled = false;
                document.getElementById('trainBtn').disabled = false;
                
            } catch (error) {
                showStatus('æ•°æ®åŠ è½½å¤±è´¥', 'error');
                appendOutput('âŒ æ•°æ®åŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        async function testGraphSAGE() {
            try {
                showStatus('æ­£åœ¨æµ‹è¯• GraphSAGE æ¨¡å‹...', 'loading');
                
                await pyodide.runPython(`
print("\\nğŸ§  GraphSAGE æ¨¡å‹æµ‹è¯•")

class SimpleGraphSAGE:
    def __init__(self, input_dim, hidden_dim, output_dim):
        self.input_dim = input_dim
        self.hidden_dim = hidden_dim
        self.output_dim = output_dim
        
        # æƒé‡åˆå§‹åŒ–
        self.W1 = np.random.randn(input_dim * 2, hidden_dim) * 0.01
        self.b1 = np.zeros(hidden_dim)
        self.W2 = np.random.randn(hidden_dim, output_dim) * 0.01
        self.b2 = np.zeros(output_dim)
    
    def relu(self, x):
        return np.maximum(0, x)
    
    def softmax(self, x):
        exp_x = np.exp(x - np.max(x, axis=1, keepdims=True))
        return exp_x / np.sum(exp_x, axis=1, keepdims=True)
    
    def aggregate_neighbors(self, features, adj_list, nodes):
        agg_features = []
        for node in nodes:
            neighbors = adj_list.get(node, [])
            if len(neighbors) == 0:
                agg_features.append(np.zeros(features.shape[1]))
            else:
                valid_neighbors = [n for n in neighbors if n < len(features)]
                if len(valid_neighbors) == 0:
                    agg_features.append(np.zeros(features.shape[1]))
                else:
                    neighbor_feat = features[valid_neighbors]
                    agg_features.append(np.mean(neighbor_feat, axis=0))
        return np.array(agg_features)
    
    def forward(self, features, adj_list, nodes):
        neighbor_feat = self.aggregate_neighbors(features, adj_list, nodes)
        self_feat = features[nodes]
        combined = np.concatenate([self_feat, neighbor_feat], axis=1)
        h1 = self.relu(np.dot(combined, self.W1) + self.b1)
        output = np.dot(h1, self.W2) + self.b2
        return output

# åˆå§‹åŒ–æ¨¡å‹
model = SimpleGraphSAGE(
    input_dim=node_features.shape[1], 
    hidden_dim=64, 
    output_dim=len(class_names)
)

print(f"ğŸ¯ æ¨¡å‹å‚æ•°: è¾“å…¥{node_features.shape[1]}, éšè—64, è¾“å‡º{len(class_names)}")

# æµ‹è¯•å‡ ä¸ªèŠ‚ç‚¹
test_nodes = [0, 10, 50]
for node in test_nodes:
    neighbors = adjacency_list.get(node, [])
    true_label = node_labels[node]
    
    pred_logits = model.forward(node_features, adjacency_list, [node])
    pred_probs = model.softmax(pred_logits)[0]
    pred_label_idx = np.argmax(pred_probs)
    pred_label = class_names[pred_label_idx]
    
    print(f"èŠ‚ç‚¹{node}: çœŸå®={true_label}, é¢„æµ‹={pred_label}, é‚»å±…={len(neighbors)}")

print("âœ… GraphSAGE æ¨¡å‹æµ‹è¯•å®Œæˆï¼")
                `);

                showStatus('æ¨¡å‹æµ‹è¯•å®Œæˆï¼', 'success');
                appendOutput('âœ… GraphSAGE å‰å‘ä¼ æ’­æµ‹è¯•æˆåŠŸ');
                
            } catch (error) {
                showStatus('æ¨¡å‹æµ‹è¯•å¤±è´¥', 'error');
                appendOutput('âŒ æ¨¡å‹æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        async function trainModel() {
            try {
                showStatus('æ­£åœ¨è®­ç»ƒ GraphSAGE æ¨¡å‹...', 'loading');
                
                await pyodide.runPython(`
print("\\nğŸš€ å¼€å§‹ GraphSAGE è®­ç»ƒ")

# æ•°æ®åˆ†å‰²
num_nodes = len(node_features)
indices = np.random.permutation(num_nodes)
train_indices = indices[:int(0.6 * num_nodes)]
val_indices = indices[int(0.6 * num_nodes):int(0.8 * num_nodes)]
test_indices = indices[int(0.8 * num_nodes):]

print(f"ğŸ“Š æ•°æ®åˆ†å‰²: è®­ç»ƒ{len(train_indices)} éªŒè¯{len(val_indices)} æµ‹è¯•{len(test_indices)}")

# ç®€åŒ–è®­ç»ƒ (æ¼”ç¤ºç‰ˆ)
print("ğŸ¯ å¼€å§‹è®­ç»ƒ...")
for epoch in range(10):
    batch_indices = np.random.choice(train_indices, 32, replace=False)
    predictions = model.forward(node_features, adjacency_list, batch_indices)
    pred_labels = np.argmax(model.softmax(predictions), axis=1)
    train_acc = np.mean(pred_labels == numeric_labels[batch_indices])
    
    if epoch % 3 == 0:
        val_predictions = model.forward(node_features, adjacency_list, val_indices[:50])
        val_pred = np.argmax(model.softmax(val_predictions), axis=1)
        val_acc = np.mean(val_pred == numeric_labels[val_indices[:50]])
        print(f"Epoch {epoch+1}: è®­ç»ƒå‡†ç¡®ç‡ {train_acc:.3f}, éªŒè¯å‡†ç¡®ç‡ {val_acc:.3f}")

# æµ‹è¯•é›†è¯„ä¼°
test_predictions = model.forward(node_features, adjacency_list, test_indices[:100])
test_pred = np.argmax(model.softmax(test_predictions), axis=1)
test_acc = np.mean(test_pred == numeric_labels[test_indices[:100]])

print(f"\\nâœ… è®­ç»ƒå®Œæˆï¼æµ‹è¯•å‡†ç¡®ç‡: {test_acc:.3f}")
print("ğŸ¯ çœŸå®æ•°æ®ç‰¹ç‚¹:")
print("  âœ“ ä½¿ç”¨3703ç»´ç¨€ç–è¯æ±‡ç‰¹å¾")
print("  âœ“ ä¿æŒçœŸå®çš„å¼•ç”¨ç½‘ç»œç»“æ„")
print("  âœ“ åæ˜ çœŸå®çš„å­¦æœ¯é¢†åŸŸåˆ†å¸ƒ")
                `);

                showStatus('æ¨¡å‹è®­ç»ƒå®Œæˆï¼', 'success');
                appendOutput('âœ… GraphSAGE è®­ç»ƒå®Œæˆï¼Œä½¿ç”¨çœŸå®æ•°æ®ç‰¹å¾');
                
            } catch (error) {
                showStatus('æ¨¡å‹è®­ç»ƒå¤±è´¥', 'error');
                appendOutput('âŒ æ¨¡å‹è®­ç»ƒå¤±è´¥: ' + error.message);
            }
        }
    </script>
</body>
</html>