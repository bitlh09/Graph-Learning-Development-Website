<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cora GCN åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #results { white-space: pre-wrap; background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 10px; }
        #visualization { width: 100%; height: 300px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Cora GCN åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. æ¨¡å—åŠ è½½æµ‹è¯•</h2>
        <button onclick="testModuleLoading()">æµ‹è¯•æ¨¡å—åŠ è½½</button>
        <div id="module-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. æ•°æ®é›†åˆå§‹åŒ–æµ‹è¯•</h2>
        <button onclick="testDatasetInit()">æµ‹è¯•æ•°æ®é›†åˆå§‹åŒ–</button>
        <div id="dataset-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. GCNæ¨¡å‹è®­ç»ƒæµ‹è¯•</h2>
        <button onclick="testGCNTraining()">å¼€å§‹è®­ç»ƒæµ‹è¯•</button>
        <div id="training-test-result"></div>
        <div id="training-progress"></div>
    </div>
    
    <div class="test-section">
        <h2>4. å¯è§†åŒ–æµ‹è¯•</h2>
        <button onclick="testVisualization()">æµ‹è¯•å›¾å¯è§†åŒ–</button>
        <div id="visualization-test-result"></div>
        <div id="visualization"></div>
    </div>
    
    <div class="test-section">
        <h2>5. ç»¼åˆåŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <div id="results"></div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="js/cora-gcn.js"></script>
    
    <script>
        function testModuleLoading() {
            var result = document.getElementById('module-test-result');
            var tests = [];
            
            // æµ‹è¯•å…¨å±€å‡½æ•°æ˜¯å¦å­˜åœ¨
            tests.push({
                name: 'initCoraDatasetå‡½æ•°',
                pass: typeof window.initCoraDataset === 'function'
            });
            
            tests.push({
                name: 'trainCoraGCNå‡½æ•°', 
                pass: typeof window.trainCoraGCN === 'function'
            });
            
            tests.push({
                name: 'visualizeCoraSampleå‡½æ•°',
                pass: typeof window.visualizeCoraSample === 'function'
            });
            
            tests.push({
                name: 'coraDatasetå¯¹è±¡',
                pass: typeof window.coraDataset === 'object'
            });
            
            var allPassed = tests.every(t => t.pass);
            var resultHtml = '<h3>æ¨¡å—åŠ è½½æµ‹è¯•ç»“æœ:</h3><ul>';
            
            tests.forEach(test => {
                resultHtml += `<li style="color: ${test.pass ? 'green' : 'red'}">
                    ${test.pass ? 'âœ…' : 'âŒ'} ${test.name}
                </li>`;
            });
            
            resultHtml += '</ul>';
            result.innerHTML = resultHtml;
            result.className = 'test-section ' + (allPassed ? 'success' : 'error');
        }
        
        function testDatasetInit() {
            var result = document.getElementById('dataset-test-result');
            
            try {
                window.initCoraDataset();
                
                var tests = [];
                tests.push({
                    name: 'ç‰¹å¾çŸ©é˜µç”Ÿæˆ',
                    pass: window.coraDataset.features && window.coraDataset.features.length === 2708
                });
                
                tests.push({
                    name: 'é‚»æ¥çŸ©é˜µç”Ÿæˆ',
                    pass: window.coraDataset.adjacency && window.coraDataset.adjacency.length === 2708
                });
                
                tests.push({
                    name: 'æ ‡ç­¾æ•°æ®ç”Ÿæˆ',
                    pass: window.coraDataset.labels && window.coraDataset.labels.length === 2708
                });
                
                tests.push({
                    name: 'ç±»åˆ«æ•°é‡æ­£ç¡®',
                    pass: window.coraDataset.classes.length === 7
                });
                
                var allPassed = tests.every(t => t.pass);
                var resultHtml = '<h3>æ•°æ®é›†åˆå§‹åŒ–æµ‹è¯•ç»“æœ:</h3><ul>';
                
                tests.forEach(test => {
                    resultHtml += `<li style="color: ${test.pass ? 'green' : 'red'}">
                        ${test.pass ? 'âœ…' : 'âŒ'} ${test.name}
                    </li>`;
                });
                
                resultHtml += `</ul><p><strong>æ•°æ®é›†ç»Ÿè®¡:</strong><br/>
                    èŠ‚ç‚¹æ•°: ${window.coraDataset.numNodes}<br/>
                    ç‰¹å¾ç»´åº¦: ${window.coraDataset.numFeatures}<br/>
                    ç±»åˆ«æ•°: ${window.coraDataset.numClasses}
                </p>`;
                
                result.innerHTML = resultHtml;
                result.className = 'test-section ' + (allPassed ? 'success' : 'error');
                
            } catch (error) {
                result.innerHTML = `<h3>âŒ æ•°æ®é›†åˆå§‹åŒ–å¤±è´¥:</h3><p style="color: red;">${error.message}</p>`;
                result.className = 'test-section error';
            }
        }
        
        async function testGCNTraining() {
            var result = document.getElementById('training-test-result');
            var progress = document.getElementById('training-progress');
            
            try {
                result.innerHTML = '<h3>ğŸš€ å¼€å§‹GCNè®­ç»ƒæµ‹è¯•...</h3>';
                progress.innerHTML = '<div style="background: #f0f0f0; border-radius: 10px; overflow: hidden;"><div id="progress-bar" style="height: 20px; background: #007bff; width: 0%; transition: width 0.3s;"></div></div><p id="progress-text">å‡†å¤‡å¼€å§‹...</p>';
                
                var trainingResults = await window.trainCoraGCN({
                    hiddenDim: 16,
                    learningRate: 0.01,
                    epochs: 50, // å‡å°‘è½®æ•°ä»¥ä¾¿å¿«é€Ÿæµ‹è¯•
                    onProgress: function(prog) {
                        var progressBar = document.getElementById('progress-bar');
                        var progressText = document.getElementById('progress-text');
                        if (progressBar && progressText) {
                            var percentage = ((prog.epoch + 1) / 50) * 100;
                            progressBar.style.width = percentage + '%';
                            progressText.textContent = `Epoch ${prog.epoch + 1}/50 - Loss: ${prog.loss.toFixed(4)}, Acc: ${prog.trainAcc.toFixed(4)}`;
                        }
                    },
                    onComplete: function(results) {
                        var testResults = [
                            {
                                name: 'æ¨¡å‹è®­ç»ƒå®Œæˆ',
                                pass: results.model !== null
                            },
                            {
                                name: 'é¢„æµ‹ç»“æœç”Ÿæˆ',
                                pass: results.predictions && results.predictions.length > 0
                            },
                            {
                                name: 'æµ‹è¯•å‡†ç¡®ç‡åˆç†',
                                pass: results.testAccuracy > 0.1 && results.testAccuracy < 1.0
                            },
                            {
                                name: 'è®­ç»ƒå†å²è®°å½•',
                                pass: results.history && results.history.losses.length > 0
                            }
                        ];
                        
                        var allPassed = testResults.every(t => t.pass);
                        var resultHtml = '<h3>GCNè®­ç»ƒæµ‹è¯•ç»“æœ:</h3><ul>';
                        
                        testResults.forEach(test => {
                            resultHtml += `<li style="color: ${test.pass ? 'green' : 'red'}">
                                ${test.pass ? 'âœ…' : 'âŒ'} ${test.name}
                            </li>`;
                        });
                        
                        resultHtml += `</ul><p><strong>è®­ç»ƒç»Ÿè®¡:</strong><br/>
                            æœ€ç»ˆæµ‹è¯•å‡†ç¡®ç‡: ${results.testAccuracy.toFixed(4)}<br/>
                            è®­ç»ƒé›†å¤§å°: ${results.split.train.length}<br/>
                            æµ‹è¯•é›†å¤§å°: ${results.split.test.length}
                        </p>`;
                        
                        result.innerHTML = resultHtml;
                        result.className = 'test-section ' + (allPassed ? 'success' : 'error');
                    }
                });
                
            } catch (error) {
                result.innerHTML = `<h3>âŒ GCNè®­ç»ƒæµ‹è¯•å¤±è´¥:</h3><p style="color: red;">${error.message}</p>`;
                result.className = 'test-section error';
            }
        }
        
        function testVisualization() {
            var result = document.getElementById('visualization-test-result');
            var viz = document.getElementById('visualization');
            
            try {
                // ç¡®ä¿æ•°æ®é›†å·²åˆå§‹åŒ–
                if (!window.coraDataset.features) {
                    window.initCoraDataset();
                }
                
                // æµ‹è¯•å¯è§†åŒ–åŠŸèƒ½
                window.visualizeCoraSample('visualization', 20);
                
                // æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº†SVG
                setTimeout(function() {
                    var svg = viz.querySelector('svg');
                    var hasNodes = viz.querySelectorAll('circle').length > 0;
                    var hasLinks = viz.querySelectorAll('line').length > 0;
                    
                    var tests = [
                        {
                            name: 'SVGå…ƒç´ åˆ›å»º',
                            pass: svg !== null
                        },
                        {
                            name: 'èŠ‚ç‚¹ç»˜åˆ¶',
                            pass: hasNodes
                        },
                        {
                            name: 'è¿æ¥çº¿ç»˜åˆ¶',
                            pass: hasLinks
                        }
                    ];
                    
                    var allPassed = tests.every(t => t.pass);
                    var resultHtml = '<h3>å¯è§†åŒ–æµ‹è¯•ç»“æœ:</h3><ul>';
                    
                    tests.forEach(test => {
                        resultHtml += `<li style="color: ${test.pass ? 'green' : 'red'}">
                            ${test.pass ? 'âœ…' : 'âŒ'} ${test.name}
                        </li>`;
                    });
                    
                    resultHtml += '</ul>';
                    result.innerHTML = resultHtml;
                    result.className = 'test-section ' + (allPassed ? 'success' : 'error');
                }, 500);
                
            } catch (error) {
                result.innerHTML = `<h3>âŒ å¯è§†åŒ–æµ‹è¯•å¤±è´¥:</h3><p style="color: red;">${error.message}</p>`;
                result.className = 'test-section error';
            }
        }
        
        async function runFullTest() {
            var results = document.getElementById('results');
            results.textContent = 'ğŸ§ª è¿è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•...\n\n';
            
            try {
                // 1. æ¨¡å—åŠ è½½æµ‹è¯•
                results.textContent += '1. æµ‹è¯•æ¨¡å—åŠ è½½...\n';
                testModuleLoading();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 2. æ•°æ®é›†åˆå§‹åŒ–
                results.textContent += '2. æµ‹è¯•æ•°æ®é›†åˆå§‹åŒ–...\n';
                testDatasetInit();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 3. å¯è§†åŒ–æµ‹è¯•
                results.textContent += '3. æµ‹è¯•å¯è§†åŒ–åŠŸèƒ½...\n';
                testVisualization();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 4. è®­ç»ƒæµ‹è¯•
                results.textContent += '4. æµ‹è¯•GCNè®­ç»ƒ...\n';
                await testGCNTraining();
                
                results.textContent += '\nâœ… å®Œæ•´æµ‹è¯•å®Œæˆï¼æ‰€æœ‰Cora GCNåŠŸèƒ½å·²æˆåŠŸé›†æˆã€‚\n';
                results.textContent += '\nğŸ“‹ åŠŸèƒ½æ¸…å•:\n';
                results.textContent += '  âœ… Coraæ•°æ®é›†æ¨¡æ‹Ÿç”Ÿæˆ\n';
                results.textContent += '  âœ… GCNæ¨¡å‹JavaScriptå®ç°\n';
                results.textContent += '  âœ… å®Œæ•´è®­ç»ƒæµç¨‹\n';
                results.textContent += '  âœ… å®æ—¶è¿›åº¦ç›‘æ§\n';
                results.textContent += '  âœ… å›¾ç»“æ„å¯è§†åŒ–\n';
                results.textContent += '  âœ… ç»“æœåˆ†æå’Œå±•ç¤º\n';
                
            } catch (error) {
                results.textContent += `\nâŒ å®Œæ•´æµ‹è¯•å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæ¨¡å—åŠ è½½æµ‹è¯•
        window.addEventListener('load', function() {
            setTimeout(testModuleLoading, 100);
        });
    </script>
</body>
</html>